<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Gratuitos!">
    <meta name="theme-color" content="#006400">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="manifest" href="/manifest.json">
    <title>Gratuitos! - Fixados</title> 
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/marlonexpert/icones/main/logo1.png">
    <link rel="icon" href="https://raw.githubusercontent.com/marlonexpert/icones/main/favicon.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <style>
        /* ==========================================================================
        1. CONFIGURAÇÃO GERAL E VARIÁVEIS DE TEMA
        ========================================================================== */
        :root {
            --bg-color: #F0F2F5;
            --text-color: #333333;
            --text-color-light: #4A4A4A;
            --card-bg-color: #FFFFFF;
            --card-shadow: 0 8px 20px rgba(0, 0, 0, 0.06); /* Sombra mais suave e elegante */
            --header-bg-color: transparent;
            --input-bg-color: #F8F8F8;
            --input-border-color: #DDDDDD;
            --button-bg-color: #E0E0E0;
            --button-text-color: #333333;
            --icon-bg-color: #555;
            --separator-color: #EEEEEE;
            --primary-color: #007BFF;
            --primary-color-rgb: 0, 123, 255;
            --primary-color-hover: #0069D9;
            --danger-color: #DC3545;
            --context-menu-bg: #FFFFFF;
            --context-menu-border: #EEEEEE;
            --context-menu-item-hover: #F0F0F0;
            --header-height-desktop: 70px; /* Um pouco mais alto para conforto */
            --header-height-mobile: 60px; 
            --icon-add-color: #006400; 
            --icon-add-color-rgb: 0, 100, 0;
            --success-color: #28A745;
            --edit-button-color: #006400;
        }

        body.dark-mode {
            --bg-color: #121212;
            --text-color: #EAEAEA;
            --text-color-light: #a0a0a0;
            --card-bg-color: #1E1E1E;
            --card-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            --header-bg-color: transparent;
            --input-bg-color: #252525;
            --input-border-color: #383838;
            --button-bg-color: #333333;
            --button-text-color: #EAEAEA;
            --icon-bg-color: #333742;
            --separator-color: #383838;
            --context-menu-bg: #252525;
            --context-menu-border: #383838;
            --context-menu-item-hover: #383838;
            --icon-add-color: #006400;
            --edit-button-color: #006400;
        }

        /* Animação de Cascata */
        @keyframes fadeSlideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        html { scroll-behavior: smooth; }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding-top: var(--header-height-desktop); 
            padding-bottom: 30px;
            transition: background-color .4s ease, color .4s ease;
            font-size: 16px;
            line-height: 1.6;
        }

        body.modal-open { overflow: hidden; }

        main {
            padding: 20px 25px;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            box-sizing: border-box;
            position: relative;
            z-index: 1;
        }

        /* ==========================================================================
        2. CABEÇALHO FLUTUANTE (GLASSMORPHISM)
        ========================================================================== */
        #page-header {
            position: fixed;
            top: 0; 
            left: 0;
            width: 100%;
            padding: 10px 25px;
            background-color: rgba(var(--primary-color-rgb), 0.03); /* Quase invisível */
            backdrop-filter: blur(12px); /* Blur mais forte para conforto visual */
            -webkit-backdrop-filter: blur(12px);
            z-index: 1000;
            box-shadow: 0 1px 0 rgba(0,0,0,0.05); /* Linha sutil */
            box-sizing: border-box;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1); /* Movimento mais natural */
        }

        #page-header.scrolled-up { transform: translateY(-100%); }
        #page-header:not(.scrolled-up) { transform: translateY(0); }

        .header-content {
            width: 100%;
            max-width: 1400px;
            display: flex;
            justify-content: flex-end; 
            gap: 12px; /* Mais espaço entre botões */
            align-items: center;
            position: relative; 
        }

        #gratuito-phrase {
            position: absolute;
            left: 0; 
            font-family: 'Dancing Script', cursive;
            font-size: 2em; 
            color: var(--text-color);
            white-space: nowrap; 
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
            cursor: pointer; 
            transform: translateX(0);
            z-index: 1; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        #gratuito-phrase.hidden {
            opacity: 0;
            transform: translateX(-20px);
            pointer-events: none;
        }

        #search-input {
            flex-grow: 1;
            padding: 10px 20px;
            border: 1px solid var(--input-border-color);
            border-radius: 30px; /* Mais arredondado */
            font-size: 1.05em;
            background-color: var(--input-bg-color);
            color: var(--text-color);
            outline: none;
            transition: all .3s cubic-bezier(0.25, 0.8, 0.25, 1);
            height: 45px;
            width: 0;
            min-width: 0;
            opacity: 0; 
            margin-right: 10px;
            pointer-events: none; 
            order: 1;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
        }

        #search-input.active {
            width: 100%;
            min-width: 100px;
            opacity: 1; 
            pointer-events: all;
        }

        #search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(var(--primary-color-rgb), 0.15);
            background-color: var(--card-bg-color);
        }

        .header-button {
            flex-shrink: 0;
            background-color: var(--button-bg-color);
            color: var(--button-text-color);
            border: none;
            border-radius: 50%;
            width: 45px; /* Botões maiores para toque */
            height: 45px;
            cursor: pointer;
            transition: all .2s cubic-bezier(0.34, 1.56, 0.64, 1); /* Efeito bounce leve */
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            z-index: 100;
        }

        #search-button-toggle, #auto-publish-button, #install-button {
            background-color: var(--icon-add-color);
            color: white;
        }

        #edit-mode-toggle {
            background-color: var(--edit-button-color);
            color: white;
        }
        
        #search-button-toggle { order: 2; }
        #edit-mode-toggle { order: 3; }
        #auto-publish-button { order: 4; }
        #install-button { order: 5; display: none; }
        #theme-toggle { order: 6; }

        .header-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        #edit-mode-toggle.active {
            box-shadow: 0 0 0 3px rgba(var(--icon-add-color-rgb), 0.5); 
            transform: scale(1.05);
        }

        #theme-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            border-radius: 30px;
            padding: 0 15px;
            width: auto;
            min-width: 100px;
        }

        /* ==========================================================================
        3. CARDS DE CATEGORIA (CASCATA)
        ========================================================================== */
        .category-grid {
            display: flex;
            flex-direction: column;
            gap: 30px; /* Espaço maior entre categorias */
        }

        .category-card {
            background-color: var(--card-bg-color);
            box-shadow: var(--card-shadow);
            border-radius: 20px; /* Bordas mais arredondadas */
            overflow: hidden; 
            transition: box-shadow .3s ease, transform 0.3s ease;
            max-width: 1400px;
            width: 100%;
            box-sizing: border-box;
            /* Animação de entrada */
            animation: fadeSlideUp 0.6s ease-out forwards;
            opacity: 0; /* Começa invisível para animação */
        }
        
        /* Delays para efeito cascata na entrada */
        .category-card:nth-child(1) { animation-delay: 0.05s; }
        .category-card:nth-child(2) { animation-delay: 0.1s; }
        .category-card:nth-child(3) { animation-delay: 0.15s; }
        .category-card:nth-child(4) { animation-delay: 0.2s; }
        .category-card:nth-child(5) { animation-delay: 0.25s; }

        #category-fixados {
            /* Destaque visual */
            border: 1px solid rgba(var(--icon-add-color-rgb), 0.2);
            position: relative;
            z-index: 10;
        }
        
        /* Ajuste do cabeçalho fixo compensado via CSS/JS, sem margens negativas complexas aqui */

        body.dark-mode .category-card {
            border: 1px solid var(--separator-color);
        }
        body.dark-mode #category-fixados {
            border-color: rgba(var(--icon-add-color-rgb), 0.5);
            background-color: rgba(0, 100, 0, 0.15); /* Fundo sutil verde no dark mode */
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            cursor: pointer;
            width: 100%;
            box-sizing: border-box;
            user-select: none;
        }

        .category-header h2 {
            margin: 0;
            font-size: 1.3em;
            color: var(--text-color);
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .category-header::after {
            content: '−';
            font-size: 1.8em;
            font-weight: bold;
            color: var(--text-color-light);
            transition: transform 0.3s ease-out;
        }

        .category-card.collapsed .category-header::after {
            transform: rotate(-90deg);
            content: '+';
        }

        .icons-grid, #search-results-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); /* Ícones levemente menores para caber mais */
            gap: 16px;
            padding: 0 30px 30px 30px; /* Padding ajustado */
            max-height: 3000px;
            transition: max-height 0.5s ease-in-out, padding 0.5s ease, opacity 0.5s ease;
            opacity: 1;
        }

        .category-card.collapsed .icons-grid {
            max-height: 0;
            padding-bottom: 0;
            opacity: 0;
            overflow: hidden; 
        }

        #search-results-container {
            display: none;
            background-color: var(--card-bg-color);
            border-radius: 20px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
        }

        /* ==========================================================================
        4. ÍCONES (VISUAL CLEAN)
        ========================================================================== */
        .icon-link {
            display: flex;
            text-decoration: none;
            border-radius: 16px;
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s ease;
            height: 90px;
            box-sizing: border-box;
            overflow: hidden;
            background-color: var(--icon-bg-color);
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .icon-link:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            z-index: 2;
        }

        .icon-link.copy-only { cursor: copy; }

        .icon-visual {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            padding: 10px;
            box-sizing: border-box;
        }

        .icon-text-content {
            color: #FFFFFF !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            text-align: center;
            width: 100%;
        }

        .icon-title {
            font-size: 0.95em;
            font-weight: 700;
            text-transform: uppercase;
            line-height: 1.2;
            word-break: break-word;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .icon-actions-button {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(0, 0, 0, 0.5);
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 10;
            opacity: 0; 
            visibility: hidden; 
            transition: all 0.2s ease;
            backdrop-filter: blur(4px);
        }

        body.edit-mode-active .icon-actions-button { opacity: 1; visibility: visible; }
        .icon-card-wrapper:hover .icon-actions-button, .icon-actions-button.active { opacity: 1; visibility: visible; }
        
        .icon-actions-button svg { width: 16px; height: 16px; fill: white; }

        /* Context Menu */
        .context-menu {
            position: absolute; 
            top: 40px;
            right: 5px;
            background-color: var(--context-menu-bg);
            border: 1px solid var(--context-menu-border);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            list-style: none;
            padding: 6px;
            margin: 0;
            z-index: 9999;
            min-width: 160px; 
            display: none;
            animation: fadeSlideUp 0.15s ease-out;
        }
        
        .context-menu.show { display: block; }
        
        .context-menu li {
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            color: var(--text-color);
            font-size: 0.9em;
            font-weight: 500;
            transition: background-color 0.1s ease;
        }

        .context-menu li:hover { background-color: var(--context-menu-item-hover); }
        .context-menu li.danger-option { color: var(--danger-color); }
        .context-menu li.danger-option:hover { background-color: rgba(220, 53, 69, 0.1); }

        /* Cores (Mantendo originais) */
        .verde { background-color: #89C623; }
        .AZUL { background-color: #2D9BFF; }
        .tsunami { background-color: #1F73B7; }
        .academia { background-color: #10559A; }
        .whatsapp { background-color: #40C351; }
        .vpn { background-color: #DF337A; }
        .bloqueador { background-color: #EE3433; }
        .feriados { background-color: #F84F39; }
        .codepen { background-color: #424242; }
        .coelba { background-color: #00a99d; }
        .embasa { background-color: #03a9f4; }
        .govbr { background-color: #01A78B; }
        .azul2 { background-color: #007bff; }
        .verde2 { background-color: #00995d; }
        .utilit { background-color: #4285f4; }
        .wordpress { background-color: #21759b; }
        .mercadolivre { background-color: #ffe600; color: #333 !important; }
        .mega { background-color: #d90000; }
        .zoom { background-color: #2d8cff; }
        .cuponomia { background-color: #f26522; }
        .bradesco { background-color: #ee1c23; }
        .senai { background-color: #004a8f; }
        .primecursos { background-color: #f9a825; color: #333 !important; }
        .baixar { background-color: #4caf50; }
        .canais { background-color: #f44336; }
        .canva { background-color: #1e1e1e; }
        .concursos { background-color: #673ab7; }
        .drive { background-color: #4285f4; }
        .clideo { background-color: #593993; }
        .multicanaislc { background-color: #29abe2; }
        .onedrive { background-color: #0078d4; }
        .globfone { background-color: #00bcd4; }
        .youtube0, .youtube1 { background-color: #ff0000; }
        .cartacapital { background-color: #c62828; }
        .iconicons { background-color: #3f51b5; }
        .pinterest { background-color: #e60023; }
        .logodownload { background-color: #000; }
        .icons8 { background-color: #00a4e5; }
        .gratispng { background-color: #8bc34a; }
        .linkcorreios { background-color: #fdd835; color: #333 !important; }
        .photoroom { background-color: #6c63ff; }
        .topflix { background-color: #212121; }
        .meuguia { background-color: #9c27b0; }
        .unopar { background-color: #0070c0; }
        .clideoaudio { background-color: #593993; }
        .azarado { background-color: #ff9800; color: #333 !important;}
        .mercadopago { background-color: #00aee4; }
        .musclewiki { background-color: #004a8f; }
        .buscape { background-color: #673ab7; }
        .gov-curso { background-color: #006400; }
        .plutotv { background-color: #121212; }
        .copilot-icon { background-image: linear-gradient(to bottom right, #2196F3, #4CAF50, #FFEB3B, #FF9800, #9C27B0); }

        /* ==========================================================================
        5. MODAL E TOAST
        ========================================================================== */
        #generator-modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            z-index: 1040;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #generator-modal-overlay.visible { display: block; opacity: 1; }

        #generate-icon-code-section {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 90%; max-width: 550px; max-height: 90vh;
            overflow-y: auto;
            z-index: 1050;
            padding: 35px;
            background-color: var(--card-bg-color);
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            display: none;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        #generate-icon-code-section.visible { display: block; opacity: 1; transform: translate(-50%, -50%) scale(1); }

        #generate-icon-code-section h2 { margin-top: 0; color: var(--text-color); }
        .form-group { margin-bottom: 20px; }
        .form-group label { font-size: 0.9em; font-weight: 600; display: block; margin-bottom: 8px; }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%; padding: 12px;
            border-radius: 10px; border: 1px solid var(--input-border-color);
            background-color: var(--input-bg-color); color: var(--text-color);
            font-family: inherit; font-size: 1em;
            box-sizing: border-box;
        }

        #submit-icon-button {
            width: 100%; padding: 14px;
            background-color: var(--primary-color); color: white;
            border: none; border-radius: 12px;
            font-size: 1.1em; font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #close-generator-modal-btn {
            position: absolute; top: 15px; right: 15px;
            background: var(--bg-color); border: none;
            border-radius: 50%; width: 32px; height: 32px;
            cursor: pointer; color: var(--text-color);
            font-weight: bold;
        }

        #confirmation-toast {
            position: fixed;
            bottom: 30px; left: 50%;
            transform: translateX(-50%) translateY(20px); 
            background-color: var(--success-color);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.4);
            opacity: 0;
            z-index: 2000;
            display: flex; align-items: center; gap: 10px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
        }

        #confirmation-toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        /* ==========================================================================
        6. MOBILE
        ========================================================================== */
        @media (max-width: 768px) {
            body { padding-top: var(--header-height-mobile); font-size: 15px; }
            main { padding: 15px; }
            .category-card { border-radius: 16px; }
            .category-header { padding: 15px 20px; }
            .icons-grid { gap: 10px; padding: 0 20px 20px 20px; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); }
            .icon-link { height: 80px; }
            #gratuito-phrase { font-size: 1.6em; left: 10px; }
            .header-button { width: 40px; height: 40px; }
        }
    </style>
</head>
<body>
    <header id="page-header">
        <div class="header-content">
            <div id="gratuito-phrase">Gratuitos!</div> 
            
            <button id="search-button-toggle" class="header-button" title="Pesquisar" aria-label="Pesquisar">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 100 13.5 6.75 6.75 0 000-13.5zM2.25 10.5a8.25 8.25 0 1114.59 5.28l4.64 4.64a.75.75 0 11-1.06 1.06l-4.64-4.64A8.25 8.25 0 012.25 10.5z" clip-rule="evenodd" />
                </svg>
            </button>
            <input type="text" id="search-input" placeholder="" aria-label="Pesquisar ícones">

            <button id="edit-mode-toggle" class="header-button" title="Modo Edição" aria-label="Ativar Modo de Edição">
                <svg id="edit-mode-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M12 1.5a5.25 5.25 0 00-5.25 5.25v3a5.25 5.25 0 0010.5 0v-3a5.25 5.25 0 00-5.25-5.25zm-1.75 12.5h3.5A1.75 1.75 0 0014 10.75v-3.5a1.75 1.75 0 00-1.75-1.75h-3.5A1.75 1.75 0 007 7.25v3.5A1.75 1.75 0 008.75 12.5zM12 14.5a.75.75 0 01-.75.75h-3.5a.75.75 0 01-.75-.75v-3.5a.75.75 0 01.75-.75h3.5a.75.75 0 01.75.75v3.5zM4.75 11.25a.75.75 0 01.75-.75h1.5a.75.75 0 010 1.5h-1.5a.75.75 0 01-.75-.75zm13.5 0a.75.75 0 01.75-.75h1.5a.75.75 0 010 1.5h-1.5a.75.75 0 01-.75-.75zM12 15a4.5 4.5 0 100 9 4.5 4.5 0 000-9zm-2.5 4.5a.75.75 0 01.75-.75h3.5a.75.75 0 01.75.75v.5a.75.75 0 01-.75.75h-3.5a.75.75 0 01-.75-.75v-.5z" clip-rule="evenodd"/>
                </svg>
            </button>

            <button id="auto-publish-button" class="header-button" title="Publicar Copiado" aria-label="Publicar">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                </svg>
            </button>
            <button id="install-button" class="header-button" title="Instalar" aria-label="Instalar Aplicativo">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M16 11V7c0-2.76-2.24-5-5-5S6 4.24 6 7v4H4v10h16V11h-4zm-6-4c0-1.66 1.34-3 3-3s3 1.34 3 3v4h-6V7zm10 12H4v-6h16v6z"/>
                </svg>
            </button>

            <button id="theme-toggle" class="header-button" title="Alternar Tema" aria-label="Alternar Tema">
                <svg id="theme-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM7.045 7.045a.75.75 0 0 1 1.06-1.06l1.591 1.59a.75.75 0 0 1-1.06 1.06l-1.59-1.591ZM18.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5h2.25a.75.75 0 01.75.75ZM6.205 17.795a.75.75 0 01-1.06-1.06l1.59-1.591a.75.75 0 011.06 1.06l-1.591 1.59ZM12 15.75a3.75 3.75 0 100 7.5 3.75 3.75 0 000-7.5ZM12 9a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V9.75A.75.75 0 0112 9Z" />
                </svg>
            </button>
        </div>
    </header>

    <main id="main-content">
        <div class="category-grid" id="all-categories-grid"></div>
        <div id="search-results-container"></div>
    </main>

    <div id="generator-modal-overlay"></div>
    <div id="generate-icon-code-section" role="dialog" aria-modal="true">
        <button id="close-generator-modal-btn">×</button>
        <h2 id="modal-title">Novo Ícone</h2>
        <form id="icon-form" novalidate>
            <input type="hidden" id="iconIdInput">
            <div class="form-group">
                <label>Nome</label>
                <input type="text" id="iconNameInput" required>
            </div>
            <div class="form-group">
                <label>Link ou Texto</label>
                <input type="url" id="iconLinkInput" required>
            </div>
            <div class="form-group">
                <label>Categoria</label>
                <select id="iconCategorySelect" required></select>
            </div>
            <div class="form-group">
                <label>Classe Cor (Opcional)</label>
                <input type="text" id="iconColorClassInput" placeholder="Ex: verde, azul">
            </div>
             <div class="form-group">
                <label>Cor Custom (Opcional)</label>
                <input type="color" id="iconCustomBgColorInput" value="#006400" style="height:40px; padding:2px;">
            </div>
             <div class="form-group" style="display:none"> <label>Imagem URL</label>
                <input type="url" id="iconImageUrlInput">
                <label>Descrição</label>
                <textarea id="iconDescriptionInput"></textarea>
            </div>
            <button type="submit" id="submit-icon-button">Salvar</button>
        </form>
        <div id="form-status-message" style="margin-top:10px;text-align:center;"></div>
    </div>

    <div id="confirmation-toast">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.815a.75.75 0 01.19 1.06l-4.5 5.25a.75.75 0 01-1.09.006l-2.25-2.5a.75.75 0 111.114-1.004l1.693 1.888 3.844-4.493a.75.75 0 011.06-.19z" clip-rule="evenodd" />
        </svg>
        <span id="toast-message">Sucesso!</span>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, doc, updateDoc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const config = {
            firebase: {
                apiKey: "AIzaSyDo4HgnZG9To1aeDoAbUd7vbfgSUAHHtSs",
                authDomain: "iconesutil.firebaseapp.com",
                projectId: "iconesutil",
                storageBucket: "iconesutil.appspot.com",
                messagingSenderId: "88285859566",
                appId: "1:88285859566:web:e15fdb0c615b494955edff"
            },
            categories: {
                'servicos-utilidades': { name: 'Serviços & Utilidades' },
                'cursos-concursos': { name: 'Cursos & Concursos' },
                'ferramentas-downloads': { name: 'Ferramentas & Downloads' },
                'compras-produtividade': { name: 'Compras & Produtividade' },
                'design-audio': { name: 'Design & Áudio' },
                'midia-entretenimento': { name: 'Mídia & Entretenimento' }
            },
            autoPublish: {
                category: 'servicos-utilidades',
                colorClass: 'gov-curso',
                isPinned: true
            }
        };

        // Cache Key
        const CACHE_KEY = 'app_local_icons_data';

        const state = {
            allIcons: [],
            currentUser: null,
            searchTerm: '',
            isEditMode: false
        };

        const isUrl = (string) => {
            try { return new URL(string).protocol.startsWith('http'); } catch (e) { return false; }
        };

        const FirebaseService = {
            db: null, auth: null,
            init() {
                const app = initializeApp(config.firebase);
                this.db = getFirestore(app);
                this.auth = getAuth(app);
            },
            authenticate(callback) {
                onAuthStateChanged(this.auth, user => {
                    if (user) state.currentUser = user;
                    else signInAnonymously(this.auth);
                    callback();
                });
            },
            onIconsUpdate(callback) {
                onSnapshot(collection(this.db, "icones"), snapshot => {
                    const icons = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    // Salva no cache sempre que o Firebase atualizar
                    localStorage.setItem(CACHE_KEY, JSON.stringify(icons));
                    callback(icons);
                });
            },
            async addIcon(data) { await addDoc(collection(this.db, "icones"), { ...data, createdAt: serverTimestamp() }); },
            async updateIcon(id, data) { await updateDoc(doc(this.db, "icones", id), data); },
            async deleteIcon(id) { await deleteDoc(doc(this.db, "icones", id)); }
        };

        const UIManager = {
            elements: {},
            init() {
                // Mapeamento de elementos
                const ids = ['main-content', 'search-input', 'search-button-toggle', 'edit-mode-toggle', 'edit-mode-icon', 
                             'auto-publish-button', 'install-button', 'theme-toggle', 'theme-icon', 
                             'all-categories-grid', 'search-results-container', 'generator-modal-overlay', 
                             'generate-icon-code-section', 'close-generator-modal-btn', 'icon-form', 
                             'form-status-message', 'modal-title', 'submit-icon-button', 'confirmation-toast', 
                             'toast-message', 'gratuito-phrase'];
                ids.forEach(id => this.elements[id] = document.getElementById(id));
                this.elements.body = document.body;

                // Popula select
                const select = this.elements['icon-form'].elements.iconCategorySelect;
                select.innerHTML = '<option value="" disabled selected>Categoria</option>';
                for (const id in config.categories) {
                    select.innerHTML += `<option value="${id}">${config.categories[id].name}</option>`;
                }
            },
            showToast(message) {
                this.elements['toast-message'].textContent = message;
                this.elements['confirmation-toast'].classList.add('show');
                setTimeout(() => this.elements['confirmation-toast'].classList.remove('show'), 2000);
            },
            copyToClipboard(text, name) {
                navigator.clipboard.writeText(text).then(() => this.showToast(`Copiado: ${name}`));
            },
            handleIconClick(e, icon) {
                if (state.isEditMode) { e.preventDefault(); return; }
                if (!isUrl(icon.link)) {
                    e.preventDefault();
                    this.copyToClipboard(icon.link, icon.name);
                }
            },
            createIconElement(icon) {
                const wrapper = document.createElement('div');
                wrapper.className = 'icon-card-wrapper';
                
                wrapper.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    if (state.isEditMode) this.showContextMenu(icon, wrapper.querySelector('.icon-actions-button'));
                    else this.handleIconClick(e, icon);
                });

                const link = document.createElement('a');
                link.href = isUrl(icon.link) ? icon.link : '#';
                link.className = 'icon-link' + (!isUrl(icon.link) ? ' copy-only' : '');
                link.target = isUrl(icon.link) ? '_blank' : '_self';
                link.rel = 'noopener noreferrer';
                link.addEventListener('click', (e) => this.handleIconClick(e, icon));

                const visual = document.createElement('div');
                visual.className = 'icon-visual ' + (icon.colorClass || '');
                if (!icon.colorClass && icon.customBgColor) visual.style.backgroundColor = icon.customBgColor;
                else if (!icon.colorClass) visual.style.backgroundColor = '#006400';

                visual.innerHTML = `<div class="icon-text-content"><span class="icon-title">${icon.name}</span></div>`;
                link.appendChild(visual);
                wrapper.appendChild(link);

                const btn = document.createElement('button');
                btn.className = 'icon-actions-button';
                btn.innerHTML = `<svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>`;
                btn.onclick = (e) => { e.preventDefault(); e.stopPropagation(); this.showContextMenu(icon, btn); };
                wrapper.appendChild(btn);

                return wrapper;
            },
            render() {
                const { 'all-categories-grid': grid, 'search-results-container': searchContainer, 'gratuito-phrase': phrase } = this.elements;
                grid.innerHTML = ''; searchContainer.innerHTML = '';

                if (state.searchTerm) {
                    searchContainer.style.display = 'grid';
                    grid.style.display = 'none';
                    phrase.classList.add('hidden');
                    const match = state.allIcons.filter(i => i.name.toLowerCase().includes(state.searchTerm));
                    match.forEach(i => searchContainer.appendChild(this.createIconElement(i)));
                    if(!match.length) searchContainer.innerHTML = '<p style="grid-column:1/-1;text-align:center;opacity:0.6">Nada encontrado.</p>';
                } else {
                    searchContainer.style.display = 'none';
                    grid.style.display = 'flex'; // Mudança para Flex (Cascata vertical)
                    phrase.classList.remove('hidden');

                    const pinned = state.allIcons.filter(i => i.isPinned).sort((a,b) => (a.createdAt?.seconds || 0) - (b.createdAt?.seconds || 0));
                    
                    if (pinned.length) {
                        const card = document.createElement('section');
                        card.className = 'category-card';
                        card.id = 'category-fixados';
                        card.innerHTML = `<div class="category-header"><h2>Acesso Rápido</h2></div><div class="icons-grid"></div>`;
                        const cardGrid = card.querySelector('.icons-grid');
                        pinned.forEach(i => cardGrid.appendChild(this.createIconElement(i)));
                        grid.appendChild(card);
                        
                        card.querySelector('.category-header').addEventListener('click', () => {
                             if(!card.classList.contains('collapsed')) this.collapseOtherCategories('category-fixados');
                             card.classList.toggle('collapsed');
                        });
                    }

                    const regular = state.allIcons.filter(i => !i.isPinned);
                    const grouped = regular.reduce((acc, i) => { (acc[i.category] = acc[i.category] || []).push(i); return acc; }, {});

                    for (const catId in config.categories) {
                        if (grouped[catId]) {
                            const card = document.createElement('section');
                            card.className = 'category-card collapsed'; // Começa fechado para foco no Fixado
                            card.id = `cat-${catId}`;
                            card.innerHTML = `<div class="category-header"><h2>${config.categories[catId].name}</h2></div><div class="icons-grid"></div>`;
                            const cardGrid = card.querySelector('.icons-grid');
                            
                            // Ordena
                            grouped[catId].sort((a,b) => (a.createdAt?.seconds || 0) - (b.createdAt?.seconds || 0))
                                          .forEach(i => cardGrid.appendChild(this.createIconElement(i)));
                            
                            grid.appendChild(card);
                            card.querySelector('.category-header').addEventListener('click', () => {
                                const isClosed = card.classList.contains('collapsed');
                                card.classList.toggle('collapsed');
                                if(isClosed) this.collapseOtherCategories(card.id);
                            });
                        }
                    }
                }
            },
            collapseOtherCategories(exceptId) {
                document.querySelectorAll('.category-card').forEach(c => {
                    if (c.id !== exceptId) c.classList.add('collapsed');
                });
            },
            showContextMenu(icon, btn) {
                document.querySelectorAll('.context-menu').forEach(m => m.remove());
                const menu = document.createElement('ul');
                menu.className = 'context-menu show';
                menu.innerHTML = `
                    <li onclick="window.App.editIcon('${icon.id}')">Editar</li>
                    <li onclick="window.App.togglePin('${icon.id}', ${!icon.isPinned})">${icon.isPinned ? 'Desafixar' : 'Fixar'}</li>
                    <li class="danger-option" onclick="window.App.deleteIcon('${icon.id}', '${icon.name}')">Excluir</li>
                `;
                btn.parentElement.appendChild(menu);
                const close = (e) => {
                    if(!menu.contains(e.target) && e.target !== btn) { menu.remove(); document.removeEventListener('click', close); }
                };
                setTimeout(() => document.addEventListener('click', close), 10);
            },
            toggleTheme(isDark) {
                this.elements.body.classList.toggle('dark-mode', isDark);
            },
            openModal(data = null) {
                const form = this.elements['icon-form'];
                form.reset();
                this.elements['modal-title'].textContent = data ? 'Editar' : 'Novo';
                if(data) {
                    form.elements.iconIdInput.value = data.id;
                    form.elements.iconNameInput.value = data.name;
                    form.elements.iconLinkInput.value = data.link;
                    form.elements.iconCategorySelect.value = data.category;
                    form.elements.iconColorClassInput.value = data.colorClass || '';
                    form.elements.iconCustomBgColorInput.value = data.customBgColor || '#006400';
                }
                this.elements['generator-modal-overlay'].classList.add('visible');
                this.elements['generate-icon-code-section'].classList.add('visible');
                this.elements.body.classList.add('modal-open');
            },
            closeModal() {
                this.elements['generator-modal-overlay'].classList.remove('visible');
                this.elements['generate-icon-code-section'].classList.remove('visible');
                this.elements.body.classList.remove('modal-open');
            }
        };

        window.App = {
            init() {
                FirebaseService.init();
                UIManager.init();
                this.bindEvents();
                
                // 1. CARREGAMENTO INSTANTÂNEO (LOCAL)
                const cached = localStorage.getItem(CACHE_KEY);
                if(cached) {
                    state.allIcons = JSON.parse(cached);
                    UIManager.render();
                }

                // 2. CONEXÃO FIREBASE (BACKGROUND)
                FirebaseService.authenticate(() => FirebaseService.onIconsUpdate(icons => {
                    // Verifica se mudou algo para evitar re-render desnecessário
                    if(JSON.stringify(icons) !== JSON.stringify(state.allIcons)) {
                        state.allIcons = icons;
                        UIManager.render();
                    }
                }));

                // Tema e scroll
                const savedTheme = localStorage.getItem('theme') || 'light';
                if(savedTheme === 'dark') UIManager.toggleTheme(true);
                this.setupScroll();
            },
            bindEvents() {
                const el = UIManager.elements;
                // Search
                el['search-button-toggle'].onclick = () => {
                    el['search-input'].classList.toggle('active');
                    if(el['search-input'].classList.contains('active')) {
                        el['search-input'].focus();
                        el['gratuito-phrase'].classList.add('hidden');
                    } else {
                        el['search-input'].value = ''; state.searchTerm = ''; UIManager.render();
                    }
                };
                el['search-input'].oninput = (e) => {
                     state.searchTerm = e.target.value.toLowerCase(); 
                     UIManager.render();
                };
                // Edit Mode
                el['edit-mode-toggle'].onclick = () => {
                    state.isEditMode = !state.isEditMode;
                    el['edit-mode-toggle'].classList.toggle('active');
                    document.body.classList.toggle('edit-mode-active');
                    el['auto-publish-button'].style.display = state.isEditMode ? 'flex' : 'flex';
                };
                // Auto Publish
                el['auto-publish-button'].onclick = async () => {
                     try {
                        const text = await navigator.clipboard.readText();
                        if(!text) return UIManager.showToast('Clipboard vazio');
                        let name = 'Novo Item';
                        if(isUrl(text)) { try { name = new URL(text).hostname.replace('www.','').split('.')[0].toUpperCase(); } catch(e){} }
                        else { name = text.split(' ')[0].substring(0,10); }
                        
                        await FirebaseService.addIcon({
                            name, link: text, category: config.autoPublish.category,
                            isPinned: true, colorClass: config.autoPublish.colorClass,
                            createdAt: serverTimestamp()
                        });
                        UIManager.showToast('Publicado!');
                     } catch(e) { console.error(e); }
                };
                // Modal
                el['close-generator-modal-btn'].onclick = () => UIManager.closeModal();
                el['generator-modal-overlay'].onclick = () => UIManager.closeModal();
                el['icon-form'].onsubmit = async (e) => {
                    e.preventDefault();
                    const f = e.target.elements;
                    const data = {
                        name: f.iconNameInput.value, link: f.iconLinkInput.value,
                        category: f.iconCategorySelect.value, colorClass: f.iconColorClassInput.value,
                        customBgColor: f.iconCustomBgColorInput.value
                    };
                    if(f.iconIdInput.value) await FirebaseService.updateIcon(f.iconIdInput.value, data);
                    else await FirebaseService.addIcon(data);
                    UIManager.closeModal();
                };
                // Theme
                el['theme-toggle'].onclick = () => {
                    const isDark = !document.body.classList.contains('dark-mode');
                    UIManager.toggleTheme(isDark);
                    localStorage.setItem('theme', isDark ? 'dark' : 'light');
                };
                
                // Keydown search
                document.addEventListener('keydown', e => {
                    if(e.key.length===1 && !e.ctrlKey && document.activeElement.tagName !== 'INPUT') {
                        el['search-input'].classList.add('active'); el['search-input'].focus();
                    }
                });
            },
            editIcon(id) { UIManager.openModal(state.allIcons.find(i => i.id === id)); },
            togglePin(id, val) { FirebaseService.updateIcon(id, { isPinned: val }); },
            deleteIcon(id, name) { if(confirm(`Excluir ${name}?`)) FirebaseService.deleteIcon(id); },
            setupScroll() {
                let lastY = 0;
                window.addEventListener('scroll', () => {
                    const y = window.pageYOffset;
                    const header = document.getElementById('page-header');
                    if (y > lastY && y > 80) header.classList.add('scrolled-up');
                    else header.classList.remove('scrolled-up');
                    lastY = y;
                });
            }
        };

        // Service Worker Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault(); deferredPrompt = e;
            document.getElementById('install-button').style.display = 'flex';
        });
        document.getElementById('install-button').onclick = async () => {
            if(deferredPrompt) { deferredPrompt.prompt(); deferredPrompt = null; document.getElementById('install-button').style.display = 'none'; }
        };

        document.addEventListener('DOMContentLoaded', App.init.bind(App));
    </script>
</body>
</html>
