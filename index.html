<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#006400">
    <title>Gratuitos! - Fixados</title>
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/marlonexpert/icones/main/logo1.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #F0F2F5; --card: #FFFFFF; --text: #333; --primary: #006400;
            --header-h: 60px; --shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        body.dark-mode {
            --bg: #121212; --card: #1E1E1E; --text: #EAEAEA; --primary: #008000;
        }

        body {
            font-family: 'Inter', sans-serif; margin: 0; background: var(--bg); color: var(--text);
            padding-top: var(--header-h); transition: 0.3s;
        }

        /* Header Minimalista */
        header {
            position: fixed; top: 0; width: 100%; height: var(--header-h);
            background: rgba(var(--bg), 0.8); backdrop-filter: blur(10px);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; box-sizing: border-box; z-index: 1000;
            transition: transform 0.3s; border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        header.hide { transform: translateY(-100%); }

        .logo { font-family: 'Dancing Script', cursive; font-size: 1.5rem; cursor: pointer; }
        
        .nav-actions { display: flex; gap: 8px; align-items: center; }
        
        .btn-circle {
            width: 38px; height: 38px; border-radius: 50%; border: none;
            background: var(--primary); color: white; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .btn-circle svg { width: 20px; height: 20px; }
        .btn-circle.secondary { background: #ccc; color: #333; }
        .btn-circle.active { ring: 3px solid var(--primary); transform: scale(1.1); }

        #search-input {
            border: 1px solid #ddd; padding: 8px 15px; border-radius: 20px;
            width: 0; opacity: 0; transition: 0.3s; outline: none;
        }
        #search-input.open { width: 150px; opacity: 1; }

        /* Grid de Itens */
        main { padding: 20px; max-width: 1200px; margin: 0 auto; }
        
        .category-section { margin-bottom: 30px; }
        .category-title { 
            font-size: 1.1rem; font-weight: 700; margin-bottom: 15px; 
            display: flex; align-items: center; justify-content: space-between;
            cursor: pointer;
        }

        .grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px; transition: max-height 0.3s ease-out; overflow: hidden;
        }
        .grid.collapsed { max-height: 0; }

        .item-card {
            background: var(--card); border-radius: 12px; height: 80px;
            display: flex; align-items: center; justify-content: center;
            text-align: center; padding: 10px; font-weight: 600; font-size: 0.9rem;
            box-shadow: var(--shadow); cursor: pointer; position: relative;
            transition: 0.2s; text-decoration: none; color: inherit;
            border: 2px solid transparent;
        }
        .item-card:hover { transform: translateY(-3px); }
        
        /* Badges de EdiÃ§Ã£o */
        .edit-badge {
            position: absolute; top: -5px; right: -5px; background: #ff4757;
            color: white; width: 22px; height: 22px; border-radius: 50%;
            display: none; align-items: center; justify-content: center; font-size: 12px;
        }
        body.edit-mode .edit-badge { display: flex; }

        /* Modal */
        #modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.5);
            display: none; align-items: center; justify-content: center; z-index: 2000;
        }
        .modal-content {
            background: var(--card); padding: 25px; border-radius: 15px;
            width: 90%; max-width: 400px;
        }
        input, select { 
            width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; 
            border-radius: 8px; box-sizing: border-box;
        }

        /* Toast */
        #toast {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: var(--primary); color: white; padding: 10px 20px;
            border-radius: 30px; display: none; z-index: 3000;
        }
    </style>
</head>
<body>

    <header id="header">
        <div class="logo" onclick="window.scrollTo({top:0, behavior:'smooth'})">Gratuitos!</div>
        <div class="nav-actions">
            <input type="text" id="search-input" placeholder="Buscar...">
            <button class="btn-circle secondary" id="btn-search"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></button>
            <button class="btn-circle secondary" id="btn-edit-mode"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></button>
            <button class="btn-circle" id="btn-add"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg></button>
            <button class="btn-circle secondary" id="btn-theme">ðŸŒ“</button>
        </div>
    </header>

    <main id="app-container">
        </main>

    <div id="modal">
        <div class="modal-content">
            <h3 id="modal-title">Novo Item</h3>
            <input type="text" id="inp-name" placeholder="Nome">
            <input type="text" id="inp-link" placeholder="Link ou Texto">
            <select id="inp-cat">
                <option value="fixados">Fixados</option>
                <option value="utilitarios">UtilitÃ¡rios</option>
                <option value="entretenimento">Entretenimento</option>
            </select>
            <button class="btn-circle" style="width: 100%; border-radius: 8px; margin-top: 10px;" id="btn-save">Salvar</button>
            <button onclick="closeModal()" style="width: 100%; background: none; border: none; margin-top: 10px; cursor: pointer;">Cancelar</button>
        </div>
    </div>

    <div id="toast">Copiado!</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, addDoc, doc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDo4HgnZG9To1aeDoAbUd7vbfgSUAHHtSs",
            authDomain: "iconesutil.firebaseapp.com",
            projectId: "iconesutil",
            storageBucket: "iconesutil.appspot.com",
            appId: "1:88285859566:web:e15fdb0c615b494955edff"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const colRef = collection(db, "icones");

        let items = JSON.parse(localStorage.getItem('cache-items')) || [];
        let editMode = false;

        // --- RenderizaÃ§Ã£o InstantÃ¢nea ---
        function render() {
            const container = document.getElementById('app-container');
            const search = document.getElementById('search-input').value.toLowerCase();
            container.innerHTML = '';

            const categories = [...new Set(items.map(i => i.category))];
            
            categories.forEach(cat => {
                const filtered = items.filter(i => i.category === cat && i.name.toLowerCase().includes(search));
                if (filtered.length === 0) return;

                const section = document.createElement('div');
                section.className = 'category-section';
                section.innerHTML = `<div class="category-title">${cat.toUpperCase()}</div><div class="grid" id="grid-${cat}"></div>`;
                container.appendChild(section);

                const grid = section.querySelector('.grid');
                filtered.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'item-card';
                    card.style.backgroundColor = item.color || 'var(--primary)';
                    card.style.color = 'white';
                    card.innerHTML = `
                        ${item.name}
                        <div class="edit-badge" onclick="deleteItem('${item.id}', event)">âœ•</div>
                    `;
                    card.onclick = () => handleItemClick(item);
                    grid.appendChild(card);
                });
            });
        }

        // --- LÃ³gica de Dados ---
        onSnapshot(colRef, (snapshot) => {
            items = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            localStorage.setItem('cache-items', JSON.stringify(items));
            render();
        });

        async function handleItemClick(item) {
            if (editMode) return;
            if (item.link.startsWith('http')) {
                window.open(item.link, '_blank');
            } else {
                navigator.clipboard.writeText(item.link);
                showToast(`Copiado: ${item.name}`);
            }
        }

        window.deleteItem = async (id, e) => {
            e.stopPropagation();
            if(confirm('Excluir este item?')) await deleteDoc(doc(db, "icones", id));
        };

        // --- Interface ---
        document.getElementById('btn-add').onclick = () => document.getElementById('modal').style.display = 'flex';
        document.getElementById('btn-save').onclick = async () => {
            const newItem = {
                name: document.getElementById('inp-name').value,
                link: document.getElementById('inp-link').value,
                category: document.getElementById('inp-cat').value,
                createdAt: serverTimestamp()
            };
            await addDoc(colRef, newItem);
            closeModal();
        };

        function closeModal() { document.getElementById('modal').style.display = 'none'; }

        document.getElementById('btn-edit-mode').onclick = (e) => {
            editMode = !editMode;
            document.body.classList.toggle('edit-mode');
            e.currentTarget.classList.toggle('active');
        };

        document.getElementById('btn-search').onclick = () => {
            document.getElementById('search-input').classList.toggle('open');
            document.getElementById('search-input').focus();
        };

        document.getElementById('search-input').oninput = render;

        document.getElementById('btn-theme').onclick = () => {
            document.body.classList.toggle('dark-mode');
        };

        // Header Hide on Scroll
        let lastScroll = 0;
        window.addEventListener('scroll', () => {
            const currentScroll = window.pageYOffset;
            if (currentScroll > lastScroll && currentScroll > 100) {
                document.getElementById('header').classList.add('hide');
            } else {
                document.getElementById('header').classList.remove('hide');
            }
            lastScroll = currentScroll;
        });

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 2000);
        }

        render(); // Chamada inicial com cache
    </script>
</body>
</html>
